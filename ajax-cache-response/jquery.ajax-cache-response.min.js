/**
 * Ajax Cache Response, Request Storage
 *    https://github.com/adamayres/jqueryplugins/tree/master/ajax-cache-response
 *  
 * Copyright (c) 2011, Adam Ayres 
 * 
 * Licensed under the MIT license:
 *    https://github.com/adamayres/jqueryplugins/raw/master/MIT-LICENSE.txt
 *
 * Tue Mar  1 17:45:23 PST 2011
 */
var requestStorage=function(){var a={},b=[];return{length:0,key:function(a){return typeof a=="number"&&b.length>=a&&a>=0?b[a]:null},getItem:function(b){return a.hasOwnProperty(b)?a[b]:null},setItem:function(c,d){a.hasOwnProperty(c)||(this.length++,b.push(c)),a[c]=d},removeItem:function(c){if(a.hasOwnProperty(c)){this.length--;for(var d=0;d<b.length;d++)b[d]==c&&b.splice(d,1)}delete a[c]},clear:function(){a={},b=[],this.length=0}}}();(function(a){var b={timeStamp:"__timeStamp__",responseText:"__responseText__",hasResponseXML:"__hasResponseXML__",responseHeaders:"__responseHeaders__"};a.ajaxCacheResponse={storage:window.requestStorage};var c=function(b){var d="";for(var e in b){var f=typeof b[e];f==="string"||f==="number"||f==="boolean"?d+=e+"="+b[e]+",":f==="object"?d+=e+"="+a.param(b[e])+",":f==="array"&&a.each(b[e],function(a,b){d+=c(b)})}return d},d=function(c,d){if(a.ajaxCacheResponse.storage.getItem(c+b.timeStamp)===null)return!1;var e=!0;if(typeof d.cacheResponseTimer=="number"){var f=parseInt(a.ajaxCacheResponse.storage.getItem(c+b.timeStamp));if(typeof f=="number"){var g=(new Date).getTime();e=f+d.cacheResponseTimer>g,e===!0&&(d.cacheTimeRemaining=d.cacheResponseTimer-(g-f))}}a.isFunction(d.cacheResponseValid)&&(e=d.cacheResponseValid.call(this,d));return e};a.ajaxPrefilter(function(e,f,g){if(e.cacheResponse===!0){if(a.ajaxCacheResponse.storage===undefined)throw"No valid storage defined for the Ajax Cache Response plugin";var h=c(f);e.cacheResponseId=h;if(d(h,e)===!0){var i=a.extend({},b);for(var j in i)i[j]=a.ajaxCacheResponse.storage.getItem(h+i[j]);e.xhr=function(){return{open:a.noop,setRequestHeader:a.noop,send:a.noop,abort:a.noop,onreadystatechange:a.noop,getResponseHeader:a.noop,getAllResponseHeaders:function(){return i.responseHeaders},readyState:4,status:200,statusText:"success",responseText:i.responseText,responseXML:i.hasResponseXML===!0?a.parseXML(i.responseText):undefined}},g.responseFromCache=!0,g.cacheTimeRemaining=e.cacheTimeRemaining}else g.responseFromCache=!1}}),a(document).ajaxSuccess(function(c,e,f,g){if(f.cacheResponse===!0){var h=f.cacheResponseId;if(d(h,f)===!1){var i=a.ajaxCacheResponse.storage;i.setItem(h+b.responseText,e.responseText),i.setItem(h+b.responseHeaders,e.getAllResponseHeaders()),i.setItem(h+b.timeStamp,(new Date).getTime()),i.setItem(h+b.hasResponseXML,e.responseXML!==undefined)}}})})(jQuery)